name: ADP Vantage
base_url: "https://vantage.adp.com"
login_url: "https://vantage.adp.com/portal/signin"

# ─────────────────────────────────────────────────────────────────────────────
# IMPORTANT: Before running, update the selectors below to match your portal.
#
# How to find the real selectors:
#   1. Log in to your ADP Vantage portal in Chrome/Edge.
#   2. Navigate to the document listing page.
#   3. Right-click a document row → Inspect.
#   4. In DevTools, hover over elements to identify the CSS classes / attributes
#      for each field (employee name, ID, doc type, date, download button).
#   5. Replace the placeholder selectors below with what you find.
#   6. Also update documents_url to the exact URL of the listing page.
#
# Tip: Use the DevTools console to test a selector before updating this file:
#   document.querySelectorAll('<your-selector>')
# ─────────────────────────────────────────────────────────────────────────────

# Navigate here after login — update to the exact documents URL for your org
documents_url: "https://vantage.adp.com/portal/documents"

selectors:
  document_list:
    # Container wrapping the full document table/list
    container: "[data-testid='document-list'], .document-list-container"
    # Each individual document row — VERIFY THIS MATCHES YOUR PORTAL
    rows: ".document-row, tr.document-item"
    # The clickable download button/link within a row — VERIFY THIS MATCHES YOUR PORTAL
    download_button: "button[aria-label*='Download'], a[aria-label*='Download'], a[href*='download']"
    # Metadata fields within each row — VERIFY THESE MATCH YOUR PORTAL
    employee_name: ".employee-name, [data-field='employeeName']"
    employee_id:   ".employee-id,   [data-field='employeeId']"
    doc_type:      ".doc-type,      [data-field='documentType']"
    doc_date:      ".doc-date,      [data-field='documentDate']"

  pagination:
    next_button:    "button[aria-label='Next page'], button.pagination-next"
    page_indicator: ".pagination-info, [aria-label*='Page']"
    # Has-next check — selector must not match when button is disabled
    has_next: "button[aria-label='Next page']:not([disabled]), button.pagination-next:not([disabled])"

browser:
  headless: false       # Must be false so you can see the login window
  slow_mo: 50           # ms delay between Playwright actions

# ── Concurrent workers ──────────────────────────────────────────────────────
# Each worker gets its own browser page (inheriting the session cookies).
# Start low and increase if the portal handles concurrent requests well.
concurrency:
  workers: 2            # Number of parallel download workers

# ── Rate limiting ───────────────────────────────────────────────────────────
# Sliding-window limit shared across all workers.
# Lower this if you see CAPTCHA challenges or HTTP 429 responses.
rate_limit:
  downloads_per_minute: 20

# ── Retry / exponential backoff ─────────────────────────────────────────────
retry:
  max_attempts: 3       # Total attempts per document (1 = no retry)
  base_delay:   2.0     # Initial wait (seconds) before first retry
  max_delay:    60.0    # Cap on backoff delay (seconds)

# ── Session timeout detection ───────────────────────────────────────────────
# URL fragments that indicate the session expired and a login redirect occurred.
session:
  expired_indicators:
    - "/signin"
    - "/login"
    - "/sso"
    - "auth/"
    - "adfs/"

download:
  # Random jitter between downloads per worker (seconds) — avoids bursty patterns
  delay_min: 1.5
  delay_max: 3.5
  # Playwright navigation/download timeout (ms)
  timeout: 30000

output:
  directory: "output/adp_vantage"
  # Tokens available: {employee_id}, {employee_name}, {doc_type}, {date}
  filename_template: "{employee_id}_{employee_name}_{doc_type}_{date}"
